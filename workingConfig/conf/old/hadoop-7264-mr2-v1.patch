commit c8cf0617752ddb3349d02c9f057fe3b14d0d73f3
Author: Luke Lu <llu@yahoo-inc.com>
Date:   Thu Aug 11 10:11:18 2011 -0700

    HADOOP-7264. Upgrade to the current avro version. (llu)

diff --git mapreduce/mr-client/hadoop-mapreduce-client-core/src/main/java/org/apache/hadoop/mapreduce/jobhistory/JobSubmittedEvent.java mapreduce/mr-client/hadoop-mapreduce-client-core/src/main/java/org/apache/hadoop/mapreduce/jobhistory/JobSubmittedEvent.java
index 850c84a..f3312d7 100644
--- mapreduce/mr-client/hadoop-mapreduce-client-core/src/main/java/org/apache/hadoop/mapreduce/jobhistory/JobSubmittedEvent.java
+++ mapreduce/mr-client/hadoop-mapreduce-client-core/src/main/java/org/apache/hadoop/mapreduce/jobhistory/JobSubmittedEvent.java
@@ -18,6 +18,7 @@
 
 package org.apache.hadoop.mapreduce.jobhistory;
 
+import java.util.EnumMap;
 import java.util.HashMap;
 import java.util.Map;
 import java.util.Map.Entry;
@@ -28,8 +29,6 @@ import org.apache.hadoop.mapreduce.JobACL;
 import org.apache.hadoop.mapreduce.JobID;
 import org.apache.hadoop.security.authorize.AccessControlList;
 
-import org.apache.avro.util.Utf8;
-
 /**
  * Event to record the submission of a job
  *
@@ -59,8 +58,8 @@ public class JobSubmittedEvent implements HistoryEvent {
     datum.jobConfPath = jobConfPath;
     Map<CharSequence, CharSequence> jobAcls = new HashMap<CharSequence, CharSequence>();
     for (Entry<JobACL, AccessControlList> entry : jobACLs.entrySet()) {
-      jobAcls.put(new Utf8(entry.getKey().getAclName()), new Utf8(
-          entry.getValue().getAclString()));
+      jobAcls.put(entry.getKey().getAclName(),
+                  entry.getValue().getAclString());
     }
     datum.acls = jobAcls;
     if (jobQueueName != null) {
@@ -70,7 +69,10 @@ public class JobSubmittedEvent implements HistoryEvent {
 
   JobSubmittedEvent() {}
 
+  @Override
   public Object getDatum() { return datum; }
+
+  @Override
   public void setDatum(Object datum) {
     this.datum = (JobSubmitted)datum;
   }
@@ -95,17 +97,18 @@ public class JobSubmittedEvent implements HistoryEvent {
   /** Get the acls configured for the job **/
   public Map<JobACL, AccessControlList> getJobAcls() {
     Map<JobACL, AccessControlList> jobAcls =
-        new HashMap<JobACL, AccessControlList>();
+        new EnumMap<JobACL, AccessControlList>(JobACL.class);
     for (JobACL jobACL : JobACL.values()) {
-      Utf8 jobACLsUtf8 = new Utf8(jobACL.getAclName());
-      if (datum.acls.containsKey(jobACLsUtf8)) {
+      String aclName = jobACL.getAclName();
+      if (datum.acls.containsKey(aclName)) {
         jobAcls.put(jobACL, new AccessControlList(datum.acls.get(
-            jobACLsUtf8).toString()));
+                    aclName).toString()));
       }
     }
     return jobAcls;
   }
   /** Get the event type */
+  @Override
   public EventType getEventType() { return EventType.JOB_SUBMITTED; }
 
 }
diff --git mapreduce/pom.xml mapreduce/pom.xml
index b84186d..ad65aec 100644
--- mapreduce/pom.xml
+++ mapreduce/pom.xml
@@ -50,33 +50,7 @@
     <dependency>
       <groupId>org.apache.avro</groupId>
       <artifactId>avro</artifactId>
-      <version>1.4.1</version>
-      <exclusions>
-        <exclusion>
-          <groupId>org.mortbay.jetty</groupId>
-          <artifactId>jetty</artifactId>
-        </exclusion>
-        <exclusion>
-          <groupId>org.apache.ant</groupId>
-          <artifactId>ant</artifactId>
-        </exclusion>
-        <exclusion>
-          <groupId>org.jboss.netty</groupId>
-          <artifactId>netty</artifactId>
-        </exclusion>
-        <exclusion>
-          <groupId>org.apache.velocity</groupId>
-          <artifactId>velocity</artifactId>
-        </exclusion>
-        <exclusion>
-          <groupId>org.slf4j</groupId>
-          <artifactId>slf4j-api</artifactId>
-        </exclusion>
-        <exclusion>
-          <artifactId>paranamer-ant</artifactId>
-          <groupId>com.thoughtworks.paranamer</groupId>
-        </exclusion>
-      </exclusions>
+      <version>1.5.1</version>
     </dependency>
     <dependency>
       <groupId>org.apache.hadoop</groupId>
@@ -96,6 +70,10 @@
           <artifactId>jasper-compiler</artifactId>
         </exclusion>
         <exclusion>
+          <groupId>javax.servlet.jsp</groupId>
+          <artifactId>jsp-api</artifactId>
+        </exclusion>
+        <exclusion>
           <groupId>org.mortbay.jetty</groupId>
           <artifactId>jsp-2.1-jetty</artifactId>
         </exclusion>
@@ -152,7 +130,7 @@
     <dependency>
       <groupId>org.jboss.netty</groupId>
       <artifactId>netty</artifactId>
-      <version>3.2.3.Final</version>
+      <version>3.2.4.Final</version>
     </dependency>
     <dependency>
       <groupId>com.cenqua.clover</groupId>
diff --git mapreduce/yarn/pom.xml mapreduce/yarn/pom.xml
index 0a4c2a4..210a16f 100644
--- mapreduce/yarn/pom.xml
+++ mapreduce/yarn/pom.xml
@@ -42,39 +42,13 @@
   <dependencies>
     <dependency>
       <groupId>org.apache.avro</groupId>
-      <artifactId>avro</artifactId>
-      <version>1.4.1</version>
-      <exclusions>
-        <exclusion>
-          <groupId>org.mortbay.jetty</groupId>
-          <artifactId>jetty</artifactId>
-        </exclusion>
-        <exclusion>
-          <groupId>org.apache.ant</groupId>
-          <artifactId>ant</artifactId>
-        </exclusion>
-        <exclusion>
-          <groupId>org.jboss.netty</groupId>
-          <artifactId>netty</artifactId>
-        </exclusion>
-        <exclusion>
-          <groupId>org.apache.velocity</groupId>
-          <artifactId>velocity</artifactId>
-        </exclusion>
-        <exclusion>
-          <groupId>org.slf4j</groupId>
-          <artifactId>slf4j-api</artifactId>
-        </exclusion>
-        <exclusion>
-          <artifactId>paranamer-ant</artifactId>
-          <groupId>com.thoughtworks.paranamer</groupId>
-        </exclusion>
-      </exclusions>
+      <artifactId>avro-ipc</artifactId>
+      <version>1.5.1</version>
     </dependency>
     <dependency>
       <groupId>com.google.protobuf</groupId>
       <artifactId>protobuf-java</artifactId>
-      <version>2.4.0a</version>
+      <version>2.4.1</version>
     </dependency>
     <dependency>
       <groupId>org.apache.hadoop</groupId>
@@ -82,10 +56,6 @@
       <version>${hadoop-common.version}</version>
       <exclusions>
         <exclusion>
-          <groupId>org.apache.avro</groupId>
-          <artifactId>avro</artifactId>
-        </exclusion>
-        <exclusion>
           <groupId>commons-el</groupId>
           <artifactId>commons-el</artifactId>
         </exclusion>
@@ -98,6 +68,10 @@
           <artifactId>jasper-compiler</artifactId>
         </exclusion>
         <exclusion>
+          <groupId>javax.servlet.jsp</groupId>
+          <artifactId>jsp-api</artifactId>
+        </exclusion>
+        <exclusion>
           <groupId>org.mortbay.jetty</groupId>
           <artifactId>jsp-2.1-jetty</artifactId>
         </exclusion>
@@ -145,7 +119,7 @@
     <dependency>
       <groupId>org.jboss.netty</groupId>
       <artifactId>netty</artifactId>
-      <version>3.2.3.Final</version>
+      <version>3.2.4.Final</version>
     </dependency>
    <dependency>
      <groupId>org.slf4j</groupId>
diff --git mapreduce/yarn/yarn-common/pom.xml mapreduce/yarn/yarn-common/pom.xml
index d7f8dcd..5947045 100644
--- mapreduce/yarn/yarn-common/pom.xml
+++ mapreduce/yarn/yarn-common/pom.xml
@@ -16,26 +16,10 @@
   </properties>
 
   <dependencies>
-  <dependency>
-    <groupId>log4j</groupId>
-    <artifactId>log4j</artifactId>
-    <version>1.2.12</version>
-    <exclusions>
-        <exclusion>
-          <groupId>com.sun.jdmk</groupId>
-          <artifactId>jmxtools</artifactId>
-        </exclusion>
-        <exclusion>
-          <groupId>com.sun.jmx</groupId>
-          <artifactId>jmxri</artifactId>
-        </exclusion>
-    </exclusions>
-   </dependency>  
-   
-  <dependency>
-    <groupId>org.apache.hadoop</groupId>
-    <artifactId>yarn-api</artifactId>
-  </dependency>
+    <dependency>
+      <groupId>org.apache.hadoop</groupId>
+      <artifactId>yarn-api</artifactId>
+    </dependency>
   </dependencies>
 
   <build>
diff --git mapreduce/yarn/yarn-common/src/main/java/org/apache/hadoop/yarn/ipc/AvroYarnRPC.java mapreduce/yarn/yarn-common/src/main/java/org/apache/hadoop/yarn/ipc/AvroYarnRPC.java
index 0f8881f..e72ff4d 100644
--- mapreduce/yarn/yarn-common/src/main/java/org/apache/hadoop/yarn/ipc/AvroYarnRPC.java
+++ mapreduce/yarn/yarn-common/src/main/java/org/apache/hadoop/yarn/ipc/AvroYarnRPC.java
@@ -24,8 +24,8 @@ import java.net.InetSocketAddress;
 import org.apache.avro.ipc.Server;
 import org.apache.avro.ipc.SocketServer;
 import org.apache.avro.ipc.SocketTransceiver;
-import org.apache.avro.specific.SpecificRequestor;
-import org.apache.avro.specific.SpecificResponder;
+import org.apache.avro.ipc.specific.SpecificRequestor;
+import org.apache.avro.ipc.specific.SpecificResponder;
 import org.apache.hadoop.conf.Configuration;
 import org.apache.hadoop.security.token.SecretManager;
 import org.apache.hadoop.security.token.TokenIdentifier;
